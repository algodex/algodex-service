<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
Welcome to Socket Test
<script type="module">
  let retry = 0;

  const log = console.log;
  console.log = function(obj) {
    document.body.innerHTML=JSON.stringify(obj, null, 2);
    log(obj);
  };

  function run() {
    console.log({
      msg: '🚀 Connecting to Service...',
      retry,
    });
    const ws = new WebSocket('ws://localhost:9090/');
    window.ws = ws;
    ws.onopen = function() {
      console.log({
        msg: '🎉 Connected to Service!',
        retry,
      });
      // socket.send(`asset/${15322902}`);
      ws.send(`blocks`);
      retry = 0;
    };
    // Listen for messages
    ws.addEventListener('message', function(event) {
      console.log({msg: '📝 Message Received', event: event.data});
      document.body.innerHTML = event.data;
      const {type} = JSON.parse(event.data);
      if (type === 'SHUTDOWN') ws.close();
    });

    ws.onclose = function({reason}) {
      console.log({
        msg: '💥 Socket Closing',
        reason,
        retry,
      });
      setTimeout(function() {
        retry++;
        run();
      }, 1000);
    };
  }
  run();
</script>
</body>
</html>
