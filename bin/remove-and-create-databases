#!/usr/bin/env node
const PouchDB = require('pouchdb');
PouchDB.plugin(require('pouchdb-erase'));
const getDatabases = require('../src/db/get-databases');

// eslint-disable-next-line require-jsdoc
async function runScript() {
  const databases = await getDatabases();
  const deletePromises = [];
  Object.values(databases).forEach( (db) => {
    if (db.appendOnly) {
      // Do not delete appendOnly databases
      return;
    }
    deletePromises.push(
        db.destroy().then(function(res) {
          console.log('destroyed');
        }).catch(function(e) {
          console.log('could not delete');
        }),
    );
  });

  Promise.all(deletePromises).then( async (res) => {
    console.log('starting creation');
    await getDatabases();
  });
}

runScript();

